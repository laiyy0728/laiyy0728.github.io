<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><link rel="manifest" href="/images/manifest.json"><meta name="keywords" content="SpringCloud,CloudConfig,"><link rel="alternate" href="/atom.xml" title="Laiyy 的个人小站" type="application/atom+xml"><meta name="description" content="Spring Cloud Config 是 Spring Cloud 微服务体系中的配置中心，是微服务中不可或缺的一部分，其能够很好的将程序中配置日益增多的各种功能的开关、参数的配置、服务器的地址等配置修改后实时生效、灰度发布，分环境、分集群管理配置等进行全面的集中化管理，有利于系统的配置管理、维护。"><meta name="keywords" content="SpringCloud,CloudConfig"><meta property="og:type" content="article"><meta property="og:title" content="Spring Cloud 微服务（27） --- Spring Cloud Config(一) &lt;BR&gt; 配置中心、实例"><meta property="og:url" content="https://www.laiyy.top/spring-cloud/spring-cloud-27.html"><meta property="og:site_name" content="Laiyy 的个人小站"><meta property="og:description" content="Spring Cloud Config 是 Spring Cloud 微服务体系中的配置中心，是微服务中不可或缺的一部分，其能够很好的将程序中配置日益增多的各种功能的开关、参数的配置、服务器的地址等配置修改后实时生效、灰度发布，分环境、分集群管理配置等进行全面的集中化管理，有利于系统的配置管理、维护。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-1.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-2.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-devops.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-git.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-repo-simple.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-endpoints.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-client.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/config-client-remote.png"><meta property="og:image" content="https://www.laiyy.top/images/spring-cloud/config/get-config-info.png"><meta property="og:updated_time" content="2019-03-04T01:51:30.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Spring Cloud 微服务（27） --- Spring Cloud Config(一) &lt;BR&gt; 配置中心、实例"><meta name="twitter:description" content="Spring Cloud Config 是 Spring Cloud 微服务体系中的配置中心，是微服务中不可或缺的一部分，其能够很好的将程序中配置日益增多的各种功能的开关、参数的配置、服务器的地址等配置修改后实时生效、灰度发布，分环境、分集群管理配置等进行全面的集中化管理，有利于系统的配置管理、维护。"><meta name="twitter:image" content="https://www.laiyy.top/images/spring-cloud/config/config-1.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.laiyy.top/spring-cloud/spring-cloud-27.html"><title>Spring Cloud 微服务（27） --- Spring Cloud Config(一)<br> 配置中心、实例 | Laiyy 的个人小站</title><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/laiyy0728" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Laiyy 的个人小站</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-关于我"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于我</a></li><li class="menu-item menu-item-标签"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-分类"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-归档"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.laiyy.top/spring-cloud/spring-cloud-27.html"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Laiyy"><meta itemprop="description" content=""><meta itemprop="image" content="/images/icon.jpg"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Laiyy 的个人小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Spring Cloud 微服务（27） --- Spring Cloud Config(一)<br> 配置中心、实例</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T09:51:30+08:00">2019-03-04</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/spring-cloud/" itemprop="url" rel="index"><span itemprop="name">spring-cloud</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1.8k 字</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">7 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p>Spring Cloud Config 是 Spring Cloud 微服务体系中的配置中心，是微服务中不可或缺的一部分，其能够很好的将程序中配置日益增多的各种功能的开关、参数的配置、服务器的地址等配置修改后实时生效、灰度发布，分环境、分集群管理配置等进行全面的集中化管理，有利于系统的配置管理、维护。</p><a id="more"></a><h1 id="Spring-Cloud-Config-配置中心"><a href="#Spring-Cloud-Config-配置中心" class="headerlink" title="Spring Cloud Config 配置中心"></a>Spring Cloud Config 配置中心</h1><h2 id="配置中心对比"><a href="#配置中心对比" class="headerlink" title="配置中心对比"></a>配置中心对比</h2><table><thead><tr><th style="text-align:center">对比方面</th><th style="text-align:center">重要性</th><th style="text-align:center">SpringCloud Config</th><th style="text-align:center">Netflix archaius</th><th style="text-align:center">携程 Apollo</th><th style="text-align:center">disconf</th></tr></thead><tbody><tr><td style="text-align:center">静态配置管理</td><td style="text-align:center">高</td><td style="text-align:center">基于 file</td><td style="text-align:center">无</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">动态配置管理</td><td style="text-align:center">高</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">统一管理</td><td style="text-align:center">高</td><td style="text-align:center">无，需要 git、数据库等</td><td style="text-align:center">无</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">多维度管理</td><td style="text-align:center">中</td><td style="text-align:center">无，需要 git、数据库等</td><td style="text-align:center">无</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">变更管理</td><td style="text-align:center">高</td><td style="text-align:center">无，需要 git、数据库等</td><td style="text-align:center">无</td><td style="text-align:center">无</td><td style="text-align:center">无</td></tr><tr><td style="text-align:center">本地配置缓存</td><td style="text-align:center">高</td><td style="text-align:center">无</td><td style="text-align:center">无</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">配置更新策略</td><td style="text-align:center">中</td><td style="text-align:center">无</td><td style="text-align:center">无</td><td style="text-align:center">无</td><td style="text-align:center">无</td></tr><tr><td style="text-align:center">配置锁</td><td style="text-align:center">中</td><td style="text-align:center">支持</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td></tr><tr><td style="text-align:center">配置校验</td><td style="text-align:center">中</td><td style="text-align:center">无</td><td style="text-align:center">无</td><td style="text-align:center">无</td><td style="text-align:center">无</td></tr><tr><td style="text-align:center">配置生效时间</td><td style="text-align:center">高</td><td style="text-align:center">重启生效、手动刷新</td><td style="text-align:center">手动刷新失效</td><td style="text-align:center">实时</td><td style="text-align:center">实时</td></tr><tr><td style="text-align:center">配置更新推送</td><td style="text-align:center">高</td><td style="text-align:center">需要手动触发</td><td style="text-align:center">需要手动触发</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">配置定时拉取</td><td style="text-align:center">高</td><td style="text-align:center">无</td><td style="text-align:center">无</td><td style="text-align:center">支持</td><td style="text-align:center">配置更新目前依赖事件驱动，client 重启或者 server 推送操作</td></tr><tr><td style="text-align:center">用户权限管理</td><td style="text-align:center">中</td><td style="text-align:center">无，需要 git、数据库等</td><td style="text-align:center">无</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">授权、审核、审计</td><td style="text-align:center">中</td><td style="text-align:center">无，需要 git、数据库等</td><td style="text-align:center">无</td><td style="text-align:center">界面直接提供发布历史、回滚按钮</td><td style="text-align:center">操作记录存在数据库中，但是无查询接口</td></tr><tr><td style="text-align:center">配置版本管理</td><td style="text-align:center">高</td><td style="text-align:center">git</td><td style="text-align:center">无</td><td style="text-align:center">支持</td><td style="text-align:center">操作记录存在数据库中，但是无查询接口</td></tr><tr><td style="text-align:center">配置合规检测</td><td style="text-align:center">高</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">支持（不完整）</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">实例配置监控</td><td style="text-align:center">高</td><td style="text-align:center">需要结合 spring admin</td><td style="text-align:center">不支持</td><td style="text-align:center">支持</td><td style="text-align:center">支持，可以查看每个配置再哪台机器上加载</td></tr><tr><td style="text-align:center">灰度发布</td><td style="text-align:center">中</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">支持</td><td style="text-align:center">不支持部分更新</td></tr><tr><td style="text-align:center">告警通知</td><td style="text-align:center">中</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">支持邮件方式告警</td><td style="text-align:center">支持邮件方式告警</td></tr><tr><td style="text-align:center">统计报表</td><td style="text-align:center">中</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td></tr><tr><td style="text-align:center">依赖关系</td><td style="text-align:center">高</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td><td style="text-align:center">不支持</td></tr><tr><td style="text-align:center">支持 SpringBoot</td><td style="text-align:center">高</td><td style="text-align:center">原生支持</td><td style="text-align:center">低</td><td style="text-align:center">支持</td><td style="text-align:center">与 SpringBoot 无关</td></tr><tr><td style="text-align:center">支持 Spring Config</td><td style="text-align:center">高</td><td style="text-align:center">原生支持</td><td style="text-align:center">低</td><td style="text-align:center">支持</td><td style="text-align:center">与 SpringBoot 无关</td></tr><tr><td style="text-align:center">客户端支持</td><td style="text-align:center">低</td><td style="text-align:center">java</td><td style="text-align:center">java</td><td style="text-align:center">java、.net</td><td style="text-align:center">java</td></tr><tr><td style="text-align:center">业务系统入侵</td><td style="text-align:center">高</td><td style="text-align:center">入侵性弱</td><td style="text-align:center">入侵性弱</td><td style="text-align:center">入侵性弱</td><td style="text-align:center">入侵性弱、支持注解和 xml</td></tr><tr><td style="text-align:center">单点故障</td><td style="text-align:center">高</td><td style="text-align:center">支持 HA 部署</td><td style="text-align:center">支持 HA 部署</td><td style="text-align:center">支持 HA 部署</td><td style="text-align:center">支持 HA 部署、高可用由 zk 提供</td></tr><tr><td style="text-align:center">多数据中心部署</td><td style="text-align:center">高</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td><td style="text-align:center">支持</td></tr><tr><td style="text-align:center">配置界面</td><td style="text-align:center">中</td><td style="text-align:center">无，需要 git、数据库等</td><td style="text-align:center">无</td><td style="text-align:center">统一界面</td><td style="text-align:center">统一界面</td></tr></tbody></table><h2 id="配置中心具备的功能"><a href="#配置中心具备的功能" class="headerlink" title="配置中心具备的功能"></a>配置中心具备的功能</h2><ul><li>Open API</li><li>业务无关性</li><li>配置生效监控</li><li>一致性 K-V 存储</li><li>统一配置实时推送</li><li>配合灰度与更新</li><li>配置全局恢复、备份、历史</li><li>高可用集群</li></ul><p><img src="/images/spring-cloud/config/config-1.png" alt="spring cloud 配置中心功能图"></p><h2 id="配置中心流转"><a href="#配置中心流转" class="headerlink" title="配置中心流转"></a>配置中心流转</h2><p>配置中心各流程流转如图：<br><img src="/images/spring-cloud/config/config-2.png" alt="Spring cloud 配置中心流转图"></p><h2 id="配置中心支撑体系"><a href="#配置中心支撑体系" class="headerlink" title="配置中心支撑体系"></a>配置中心支撑体系</h2><p>配置中心的支撑体系大致有两类</p><ul><li>开发管理体系</li><li>运维管理体系<br><img src="/images/spring-cloud/config/config-devops.png" alt="Spring 开发、运维体系"></li></ul><hr><h1 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h1><h2 id="Spring-Cloud-Config-概述"><a href="#Spring-Cloud-Config-概述" class="headerlink" title="Spring Cloud Config 概述"></a>Spring Cloud Config 概述</h2><p>Spring Cloud Config 是一个集中化、外部配置的分布式系统，由服务端、客户端组成，它不依赖于注册中心，是一个独立的配置中心。Spring Cloud Config 支持多种存储配置信息的形式，目前主要有 jdbc、vault、Navicat、svn、git 等形式，默认为 git。</p><h2 id="git-版工作原理"><a href="#git-版工作原理" class="headerlink" title="git 版工作原理"></a>git 版工作原理</h2><p>配置客户端启动时，会向服务端发起请求，服务端接收到客户端的请求后，根据配置的仓库地址，将 git 上的文件克隆到本地的一个临时目录中，这个目录是一个 git 的本地仓库，然后服务端再读取本地文件，返回给客户端。这样做的好处是：当 git 服务故障或网络请求异常时，保证服务端依然能正常工作。</p><p><img src="/images/spring-cloud/config/config-git.png" alt="Spring Cloud Config git 版工作原理"></p><hr><h1 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h1><h2 id="config-repo"><a href="#config-repo" class="headerlink" title="config repo"></a>config repo</h2><p>使用 git 做配置中心的配置文件存储，需要一个 git 仓库，用于保存配置文件。 本例仓库地址： <a href="https://gitee.com/laiyy0728/config-repo" target="_blank" rel="noopener">https://gitee.com/laiyy0728/config-repo</a></p><p>在仓库中，新建一个文件夹：<code>config-simple</code>，在文件夹内新建 3 个文件：<code>config-simple-dev.yml</code>、<code>config-simple-test.yml</code>、<code>config-simple-prod.yml</code><br><img src="/images/spring-cloud/config/config-repo-simple.png" alt="Spring Cloud Simple Config"></p><p><strong><em>源码：<a href="https://gitee.com/laiyy0728/spring-cloud/tree/master/spring-cloud-config/spring-cloud-config-simple" target="_blank" rel="noopener">https://gitee.com/laiyy0728/spring-cloud/tree/master/spring-cloud-config/spring-cloud-config-simple</a></em></strong></p><h2 id="config-server"><a href="#config-server" class="headerlink" title="config server"></a>config server</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      server:</span></span><br><span class="line"><span class="attr">        git:</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="attr">https://gitee.com/laiyy0728/config-repo</span> <span class="comment"># git 仓库地址</span></span><br><span class="line"><span class="attr">          search-paths:</span> <span class="string">config-simple</span> <span class="comment"># 从哪个文件夹下拉取配置</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">spring-cloud-config-simple-server</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">9090</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringCloudConfigSimpleServerApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringCloudConfigSimpleServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="验证-config-server"><a href="#验证-config-server" class="headerlink" title="验证 config server"></a>验证 config server</h2><p>启动 config server，查看 endpoints mappings<br><img src="/images/spring-cloud/config/config-endpoints.png" alt="Spring Cloud Config Endpoints"></p><ul><li>label：代表请求的是哪个分支，默认是 master 分支</li><li>name：代表请求哪个名称的远程文件</li><li>profile：代表哪个版本的文件，如：dev、test、prod 等</li></ul><p>从 mappings 中，可以看出，访问获取一个配置的信息，有多种方式，尝试获取 <code>/config-simple/config-simple.dev.yml</code> 配置信息：</p><h3 id="由接口获取配置详细信息"><a href="#由接口获取配置详细信息" class="headerlink" title="由接口获取配置详细信息"></a>由接口获取配置详细信息</h3><p><a href="http://localhost:9090/config-simple/dev/master" target="_blank" rel="noopener">http://localhost:9090/config-simple/dev/master</a> 、<a href="http://localhost:9090/config-simple/dev" target="_blank" rel="noopener">http://localhost:9090/config-simple/dev</a><br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>: <span class="string">"config-simple"</span>,</span><br><span class="line">	<span class="attr">"profiles"</span>: [</span><br><span class="line">		<span class="string">"dev"</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">"label"</span>: <span class="string">"master"</span>,</span><br><span class="line">	<span class="attr">"version"</span>: <span class="string">"520b379e9c7f2e39bb56e599f914b6c08fe13c06"</span>,</span><br><span class="line">	<span class="attr">"state"</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">"propertySources"</span>: [&#123;</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"https://gitee.com/laiyy0728/config-repo/config-simple/config-simple-dev.yml"</span>,</span><br><span class="line">		<span class="attr">"source"</span>: &#123;</span><br><span class="line">			<span class="attr">"com.laiyy.gitee.config"</span>: <span class="string">"dev 环境，git 版 spring cloud config"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="由绝对文件路径获取配置文件内容"><a href="#由绝对文件路径获取配置文件内容" class="headerlink" title="由绝对文件路径获取配置文件内容"></a>由绝对文件路径获取配置文件内容</h3><p><a href="http://localhost:9090/master/config-simple-dev.yml" target="_blank" rel="noopener">http://localhost:9090/master/config-simple-dev.yml</a> 、<a href="http://localhost:9090/config-simple-dev.yml" target="_blank" rel="noopener">http://localhost:9090/config-simple-dev.yml</a><br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">com:</span></span><br><span class="line"><span class="attr">  laiyy:</span></span><br><span class="line"><span class="attr">    gitee:</span></span><br><span class="line"><span class="attr">      config:</span> <span class="string">dev</span> <span class="string">环境，git</span> <span class="string">版</span> <span class="string">spring</span> <span class="string">cloud</span> <span class="string">config</span></span><br></pre></td></tr></table></figure><p></p><h2 id="config-client"><a href="#config-client" class="headerlink" title="config client"></a>config client</h2><p>在 config server 中获取配置文件以及成功，接下来需要在 config client 中，通过 config server 获取对应的配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong><em>application.yml</em></strong><br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      label:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">      uri:</span> <span class="attr">http://localhost:9090</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">config-simple</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">spring-cloud-config-simple-client</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">9091</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于从远程 config server 获取配置文件内容</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"com.laiyy.gitee"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigInfoProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String config;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfig</span><span class="params">(String config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于打印获取到的配置文件内容</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConfigInfoProperties configInfoProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConfigController</span><span class="params">(ConfigInfoProperties configInfoProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.configInfoProperties = configInfoProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/get-config-info"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> configInfoProperties.getConfig();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动类</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringCloudConfigSimpleClientApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringCloudConfigSimpleClientApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="验证-config-client"><a href="#验证-config-client" class="headerlink" title="验证 config client"></a>验证 config client</h2><p>启动 config client，观察控制台，发现 config client 拉取配置的路径是：<a href="http://localhost:8888" target="_blank" rel="noopener">http://localhost:8888</a> ，而不是在 yml 中配置的 localhost:9090。这是因为 boot 启动时加载配置文件的顺序导致的。boot 默认先加载 bootstrap.yml 配置，再加载 application.yml 配置。所以需要将 config server 配置移到 bootstrap.yml 中<br><img src="/images/spring-cloud/config/config-client.png" alt="Config client default fetch server"></p><p><strong><em>bootstrap.yml</em></strong><br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      label:</span> <span class="string">master</span>  <span class="comment"># 代表请求 git 哪个分支，默认 master</span></span><br><span class="line"><span class="attr">      uri:</span> <span class="attr">http://localhost:9090</span> <span class="comment"># config server 地址</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">config-simple</span> <span class="comment"># 获取哪个名称的远程文件，可以有多个，英文逗号隔开</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">dev</span> <span class="comment"># 代表哪个分支</span></span><br></pre></td></tr></table></figure><p></p><p><strong><em>application.yml</em></strong><br></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">spring-cloud-config-simple-client</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">9091</span></span><br></pre></td></tr></table></figure><p></p><p><img src="/images/spring-cloud/config/config-client-remote.png" alt="config client remote server"></p><p>访问 <a href="http://localhost:9091/get-config-info" target="_blank" rel="noopener">http://localhost:9091/get-config-info</a><br><img src="/images/spring-cloud/config/get-config-info.png" alt="get config info"></p></div><div><div><div style="text-align:center;color:#bbb;font-size:15px"><br>-------------本文结束<i class="fa fa-paw"></i> 感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Laiyy</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.laiyy.top/spring-cloud/spring-cloud-27.html" title="Spring Cloud 微服务（27） --- Spring Cloud Config(一) <BR> 配置中心、实例">https://www.laiyy.top/spring-cloud/spring-cloud-27.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/SpringCloud/" rel="tag"><i class="fa fa-tag"></i> SpringCloud</a><a href="/tags/CloudConfig/" rel="tag"><i class="fa fa-tag"></i> CloudConfig</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/spring-cloud/spring-cloud-26.html" rel="next" title="Spring Cloud 微服务（26） --- Zuul(七) <BR> Zuul 优化、Zuul 工作原理"><i class="fa fa-chevron-left"></i> Spring Cloud 微服务（26） --- Zuul(七)<br> Zuul 优化、Zuul 工作原理</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/spring-cloud/spring-cloud-28.html" rel="prev" title="Spring Cloud 微服务（28） --- Spring Cloud Config(二) <BR> 刷新配置">Spring Cloud 微服务（28） --- Spring Cloud Config(二)<br> 刷新配置<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c42b60d6ef7b089" async="async"></script></div></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/icon.jpg" alt="Laiyy"><p class="site-author-name" itemprop="name">Laiyy</p><p class="site-description motion-element" itemprop="description">简介</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">76</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">17</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">33</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/laiyy0728" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:laiyy0728@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/8fa6bf5f8bd9" target="_blank" title="简  书"><i class="fa fa-fw fa-book"></i> 简 书</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-Cloud-Config-配置中心"><span class="nav-number">1.</span> <span class="nav-text">Spring Cloud Config 配置中心</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置中心对比"><span class="nav-number">1.1.</span> <span class="nav-text">配置中心对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置中心具备的功能"><span class="nav-number">1.2.</span> <span class="nav-text">配置中心具备的功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置中心流转"><span class="nav-number">1.3.</span> <span class="nav-text">配置中心流转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置中心支撑体系"><span class="nav-number">1.4.</span> <span class="nav-text">配置中心支撑体系</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-Cloud-Config"><span class="nav-number">2.</span> <span class="nav-text">Spring Cloud Config</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Cloud-Config-概述"><span class="nav-number">2.1.</span> <span class="nav-text">Spring Cloud Config 概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#git-版工作原理"><span class="nav-number">2.2.</span> <span class="nav-text">git 版工作原理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#入门案例"><span class="nav-number">3.</span> <span class="nav-text">入门案例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#config-repo"><span class="nav-number">3.1.</span> <span class="nav-text">config repo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#config-server"><span class="nav-number">3.2.</span> <span class="nav-text">config server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证-config-server"><span class="nav-number">3.3.</span> <span class="nav-text">验证 config server</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#由接口获取配置详细信息"><span class="nav-number">3.3.1.</span> <span class="nav-text">由接口获取配置详细信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#由绝对文件路径获取配置文件内容"><span class="nav-number">3.3.2.</span> <span class="nav-text">由绝对文件路径获取配置文件内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#config-client"><span class="nav-number">3.4.</span> <span class="nav-text">config client</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证-config-client"><span class="nav-number">3.5.</span> <span class="nav-text">验证 config client</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">UV:<span id="busuanzi_value_site_uv"></span></span></div> <span class="post-meta-divider">|</span><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_pv">PV:<span id="busuanzi_value_site_pv"></span></span></div><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">laiyy</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">网站总字数&#58;</span> <span title="网站总字数">134.3k 字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script></body></html><script type="text/javascript" src="/js/src/clipboard.min.js"></script><script type="text/javascript" src="/js/src/clipboard-use.js"></script>