<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><link rel="manifest" href="/images/manifest.json"><meta name="keywords" content="hive,"><link rel="alternate" href="/atom.xml" title="Laiyy 的个人小站" type="application/atom+xml"><meta name="description" content="select deptno, count(*) from emp group by mgr。这条语句如果直接执行是会报错的，此时就可以用窗口函数来解决。"><meta name="keywords" content="hive"><meta property="og:type" content="article"><meta property="og:title" content="Hive(十二) &lt;BR&#x2F;&gt; 常用函数——窗口函数"><meta property="og:url" content="https://www.laiyy.top/hive/hive-12.html"><meta property="og:site_name" content="Laiyy 的个人小站"><meta property="og:description" content="select deptno, count(*) from emp group by mgr。这条语句如果直接执行是会报错的，此时就可以用窗口函数来解决。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://www.laiyy.top/images/hive/db/group-by.png"><meta property="og:image" content="https://www.laiyy.top/images/hive/db/over.png"><meta property="og:updated_time" content="2020-01-07T08:55:17.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hive(十二) &lt;BR&#x2F;&gt; 常用函数——窗口函数"><meta name="twitter:description" content="select deptno, count(*) from emp group by mgr。这条语句如果直接执行是会报错的，此时就可以用窗口函数来解决。"><meta name="twitter:image" content="https://www.laiyy.top/images/hive/db/group-by.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.laiyy.top/hive/hive-12.html"><title>Hive(十二)<br> 常用函数——窗口函数 | Laiyy 的个人小站</title><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/laiyy0728" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Laiyy 的个人小站</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-关于我"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于我</a></li><li class="menu-item menu-item-标签"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-分类"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-归档"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.laiyy.top/hive/hive-12.html"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Laiyy"><meta itemprop="description" content=""><meta itemprop="image" content="/images/icon.jpg"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Laiyy 的个人小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Hive(十二)<br> 常用函数——窗口函数</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-07T16:55:17+08:00">2020-01-07</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/hive/" itemprop="url" rel="index"><span itemprop="name">hive</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1.7k 字</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">7 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p><code>select deptno, count(*) from emp group by mgr</code>。这条语句如果直接执行是会报错的，此时就可以用窗口函数来解决。</p><a id="more"></a><h1 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h1><p>OVER：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变化而变化。</p><p>OVER 函数可能出现的连接属性：</p><blockquote><p>用在 over 函数内的</p><blockquote><p>CURRENT ROW：当前行<br>n PRECEDING：往前 n 行数据<br>n FOLLOWING：往后 n 行数据<br>UNBOUNDED：起点<br>UNBOUNDED PRECEDING：从前面的起点<br>UNBOUNDED FOLLOWING：到后面的起点</p></blockquote></blockquote><blockquote><p>用在 over 函数外</p><blockquote><p>LAG(col, n, default_value)：往前第 n 行数据<br>LEAD(col, n, default_value)：往后第 n 行数据<br>NTILE(n)：把有序分区中的行分发到指定数据的组中，各个组有编号，编号从 1 开始；对于每一行，NTILE 返回慈航所属组的编号；n 必须是 int 类型</p></blockquote></blockquote><p><strong>根据 <a href="/file/hive/over.txt">测试数据</a>，实现以下需求</strong></p><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote><p><a href="#%e9%9c%80%e6%b1%82-1">需求 1</a>：查询在 2017 年 4 月份购买过的顾客及总人数<br><a href="#%e9%9c%80%e6%b1%82-2">需求 2</a>：查询顾客的购买明细及总购买总额<br><a href="#%e9%9c%80%e6%b1%82-3">需求 3</a>：基于上述场景，将 cost 按照日期进行累加<br><a href="#%e9%9c%80%e6%b1%82-4">需求 4</a>：查询顾客的购买明细及每个顾客的购买总额<br><a href="#%e9%9c%80%e6%b1%82-5">需求 5</a>：查询顾客购买明细，并将 cost 按累加金额（与需求 3 不同之处在于需求 3 是累加总额，此需求是累加每个顾客的总额）<br><a href="#%e9%9c%80%e6%b1%82-6">需求 6</a>查询顾客上次的购买时间<br><a href="#%e9%9c%80%e6%b1%82-7">需求 7</a>查询前 20% 时间的订单信息</p></blockquote><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; create table business(</span><br><span class="line">              &gt; name string,</span><br><span class="line">              &gt; orderdate string,</span><br><span class="line">              &gt; cost int</span><br><span class="line">              &gt; ) ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';</span><br><span class="line">OK</span><br><span class="line">Time taken: 0.072 seconds</span><br></pre></td></tr></table></figure><h2 id="需求-1"><a href="#需求-1" class="headerlink" title="需求 1"></a>需求 1</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">count</span>(*) <span class="keyword">from</span> business <span class="keyword">where</span> <span class="keyword">substring</span>(orderdate, <span class="number">1</span>, <span class="number">7</span>) = <span class="string">'2017-04'</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure><p>用此语句的查询结果为：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name	_c1</span><br><span class="line">jack	1</span><br><span class="line">mart	4</span><br><span class="line">Time taken: 36.572 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure><p></p><p>这个结果是查询出来的是 2017 年 4 月份购买过的顾客，可这个顾客购买的次数，并不是总人数。所以这个方案是不行的。</p><blockquote><p>使用窗口函数进行查询</p></blockquote><ol><li>在 count(*) 后加 over()</li><li>count(*) 与 over() 使用空格隔开即可</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">count</span>(*) <span class="keyword">over</span>() <span class="keyword">from</span> business <span class="keyword">where</span> <span class="keyword">substring</span>(orderdate, <span class="number">1</span>, <span class="number">7</span>) = <span class="string">'2017-04'</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure><p>此时的查询结果是正确的。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name	count_window_0</span><br><span class="line">mart	2</span><br><span class="line">jack	2</span><br><span class="line">Time taken: 37.903 seconds, Fetched: 2 row(s)</span><br></pre></td></tr></table></figure><p></p><ol><li>over() 函数必须跟在 <code>聚合函数</code> 的后面</li><li>over() 函数调用时也叫做 <code>开窗</code>，意义在于对整个数据集开了个窗口</li><li>over() 开的窗口仅仅是给 count(*) 这个聚合函数用的</li><li>对每个数据都开了一个窗口</li></ol><blockquote><p>流程</p></blockquote><p>去掉 <code>count(*) over()</code> 后，运行剩余语句，结果集为<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name</span><br><span class="line">mart</span><br><span class="line">jack</span><br></pre></td></tr></table></figure><p></p><p>在加上 <code>count(*) over()</code> 后，由于 over() 函数没有传参，代表针对所有结果集生效。此时结果集供有 2 条数据，则会开两个窗口。<br>即为 mart 开了一个窗，窗口大小是全局的，即为 2，则此时对开窗后的数据进行 count，则 count 为 2；同理 jack 的 count 也为 2。<br>开窗计算结束后，返回的 count 就是 2，则运行结果就是现在展示出来的样子。</p><blockquote><p>group by 的流程<br><img src="/images/hive/db/group-by.png" alt="group by"></p></blockquote><blockquote><p>over 流程<br><img src="/images/hive/db/over.png" alt="over"></p></blockquote><h2 id="需求-2"><a href="#需求-2" class="headerlink" title="需求 2"></a>需求 2</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select *, sum(cost) over() from business;</span><br><span class="line">Query ID = root_20200108145947_5ea91675-0dd0-4b53-bbb0-4d1324bc52d9</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">business.name	business.orderdate	business.cost	sum_window_0</span><br><span class="line">mart	2017-04-13	94	661</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">jack	2017-01-01	10	661</span><br><span class="line">Time taken: 37.215 seconds, Fetched: 14 row(s)</span><br></pre></td></tr></table></figure><h2 id="需求-3"><a href="#需求-3" class="headerlink" title="需求 3"></a>需求 3</h2><p>可以看到，每个月的总额是当月销售额加上之前月份的销售额的总和。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select orderdate, cost, sum(cost) over(order by orderdate)</span><br><span class="line">              &gt;  from business;</span><br><span class="line">Query ID = root_20200108150530_45152897-77dd-4167-af1e-13c945b31b31</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">orderdate	cost	sum_window_0</span><br><span class="line">2017-01-01	10	10</span><br><span class="line">2017-01-02	15	25</span><br><span class="line">2017-01-04	29	54</span><br><span class="line"></span><br><span class="line">... </span><br><span class="line"></span><br><span class="line">2017-04-13	94	569</span><br><span class="line">2017-05-10	12	581</span><br><span class="line">2017-06-12	80	661</span><br><span class="line">Time taken: 17.268 seconds, Fetched: 14 row(s)</span><br></pre></td></tr></table></figure><h2 id="需求-4"><a href="#需求-4" class="headerlink" title="需求 4"></a>需求 4</h2><p>思路：按照顾客进行分组。</p><p>通常情况下，分组用 group by 即可，但需要注意的是，窗口函数是不能用 group by 的。可以使用类似的 distribute by 来进行操作。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select *, sum(cost) over(distribute by name) from business;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">business.name	business.orderdate	business.cost	sum_window_0</span><br><span class="line">jack	2017-01-05	46	176</span><br><span class="line">jack	2017-01-08	55	176</span><br><span class="line">jack	2017-01-01	10	176</span><br><span class="line">jack	2017-04-06	42	176</span><br><span class="line">jack	2017-02-03	23	176</span><br><span class="line">mart	2017-04-13	94	299</span><br><span class="line">mart	2017-04-11	75	299</span><br><span class="line">mart	2017-04-09	68	299</span><br><span class="line">mart	2017-04-08	62	299</span><br><span class="line">neil	2017-05-10	12	92</span><br><span class="line">neil	2017-06-12	80	92</span><br><span class="line">tony	2017-01-04	29	94</span><br><span class="line">tony	2017-01-02	15	94</span><br><span class="line">tony	2017-01-07	50	94</span><br><span class="line">Time taken: 19.168 seconds, Fetched: 14 row(s)</span><br></pre></td></tr></table></figure><h2 id="需求-5"><a href="#需求-5" class="headerlink" title="需求 5"></a>需求 5</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select *, sum(cost) over(distribute by name sort by orderdate) from business;</span><br><span class="line">Query ID = root_20200108153257_3b1c7cdb-ed63-4f8d-ac93-46a090a51c27</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">business.name	business.orderdate	business.cost	sum_window_0</span><br><span class="line">jack	2017-01-01	10	10</span><br><span class="line">jack	2017-01-05	46	56</span><br><span class="line">jack	2017-01-08	55	111</span><br><span class="line">jack	2017-02-03	23	134</span><br><span class="line">jack	2017-04-06	42	176</span><br><span class="line">mart	2017-04-08	62	62</span><br><span class="line">mart	2017-04-09	68	130</span><br><span class="line">mart	2017-04-11	75	205</span><br><span class="line">mart	2017-04-13	94	299</span><br><span class="line">neil	2017-05-10	12	12</span><br><span class="line">neil	2017-06-12	80	92</span><br><span class="line">tony	2017-01-02	15	15</span><br><span class="line">tony	2017-01-04	29	44</span><br><span class="line">tony	2017-01-07	50	94</span><br><span class="line">Time taken: 17.41 seconds, Fetched: 14 row(s)</span><br></pre></td></tr></table></figure><h2 id="需求-6"><a href="#需求-6" class="headerlink" title="需求 6"></a>需求 6</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select *, lag(orderdate, 1, &apos;1970-01-01&apos;) over(distribute by name sort by orderdate) from business;</span><br><span class="line">Query ID = root_20200108154129_6bc92c4b-4095-46a9-92bb-4e261d0cfcfa</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">business.name	business.orderdate	business.cost	lag_window_0</span><br><span class="line">jack	2017-01-01	10	1970-01-01</span><br><span class="line">jack	2017-01-05	46	2017-01-01</span><br><span class="line">jack	2017-01-08	55	2017-01-05</span><br><span class="line">jack	2017-02-03	23	2017-01-08</span><br><span class="line">jack	2017-04-06	42	2017-02-03</span><br><span class="line">mart	2017-04-08	62	1970-01-01</span><br><span class="line">mart	2017-04-09	68	2017-04-08</span><br><span class="line">mart	2017-04-11	75	2017-04-09</span><br><span class="line">mart	2017-04-13	94	2017-04-11</span><br><span class="line">neil	2017-05-10	12	1970-01-01</span><br><span class="line">neil	2017-06-12	80	2017-05-10</span><br><span class="line">tony	2017-01-02	15	1970-01-01</span><br><span class="line">tony	2017-01-04	29	2017-01-02</span><br><span class="line">tony	2017-01-07	50	2017-01-04</span><br><span class="line">Time taken: 24.159 seconds, Fetched: 14 row(s)</span><br></pre></td></tr></table></figure><h2 id="需求-7"><a href="#需求-7" class="headerlink" title="需求 7"></a>需求 7</h2><blockquote><p>ntile(5) over(order by orderdate)：将数组分为 5 个组，按照时间排序<br>where ntile_5 = 1：查询第一个组，即前 20%</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select name, orderdate, cost from (</span><br><span class="line">              &gt; select name, orderdate, cost, ntile(5) over(order by orderdate) ntile_5 from business</span><br><span class="line">              &gt; ) t1 where ntile_5 = 1;</span><br><span class="line">Query ID = root_20200108155352_e7cd86d2-1949-4cfc-91a8-18e6fe11a3ec</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">name	orderdate	cost</span><br><span class="line">jack	2017-01-01	10</span><br><span class="line">tony	2017-01-02	15</span><br><span class="line">tony	2017-01-04	29</span><br><span class="line">Time taken: 17.475 seconds, Fetched: 3 row(s)</span><br></pre></td></tr></table></figure><hr><h1 id="Rank-函数"><a href="#Rank-函数" class="headerlink" title="Rank 函数"></a>Rank 函数</h1><p>Rank 排名函数。</p><blockquote><p>RANK()：排序相同时会重复，总数不变<br>DENSE_RANK()：排序相同时会重复，总数减少<br>ROW_NUMER()：根据顺序计算</p></blockquote><p>使用 <a href="/file/hive/rank.txt">测试数据</a> 测试 Rank 函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score(</span><br><span class="line"><span class="keyword">name</span> <span class="keyword">string</span>,</span><br><span class="line">subject <span class="keyword">string</span>,</span><br><span class="line">score <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">"\t"</span>;</span><br></pre></td></tr></table></figure><h2 id="同时测试三种-rank-方式"><a href="#同时测试三种-rank-方式" class="headerlink" title="同时测试三种 rank 方式"></a>同时测试三种 rank 方式</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; select *, rank() over(partition by subject order by score desc) rank1,</span><br><span class="line">              &gt; dense_rank() over(partition by subject order by score desc) rank2,</span><br><span class="line">              &gt; row_number() over(partition by subject order by score desc) rank3</span><br><span class="line">              &gt; from score;</span><br><span class="line">Query ID = root_20200108160934_e99e5b37-0a2c-41c8-a545-4394a10f14e4</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">score.name	score.subject	score.score	rank1	rank2	rank3</span><br><span class="line">孙悟空	数学	95	1	1	1</span><br><span class="line">猪八戒	数学	86	2	2	2</span><br><span class="line">婷婷	数学	85	3	3	3</span><br><span class="line">大海	数学	56	4	4	4</span><br><span class="line">猪八戒	英语	84	1	1	1</span><br><span class="line">大海	英语	84	1	1	2</span><br><span class="line">婷婷	英语	78	3	2	3</span><br><span class="line">孙悟空	英语	68	4	3	4</span><br><span class="line">大海	语文	94	1	1	1</span><br><span class="line">孙悟空	语文	87	2	2	2</span><br><span class="line">婷婷	语文	65	3	3	3</span><br><span class="line">猪八戒	语文	64	4	4	4</span><br><span class="line">Time taken: 21.184 seconds, Fetched: 12 row(s)</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#bbb;font-size:15px"><br>-------------本文结束<i class="fa fa-paw"></i> 感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Laiyy</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.laiyy.top/hive/hive-12.html" title="Hive(十二) <BR/> 常用函数——窗口函数">https://www.laiyy.top/hive/hive-12.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/hive/" rel="tag"><i class="fa fa-tag"></i> hive</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/hive/hive-11.html" rel="next" title="Hive(十一) <BR/> 常用函数"><i class="fa fa-chevron-left"></i> Hive(十一)<br> 常用函数</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/hive/hive-13.html" rel="prev" title="Hive(十三) <BR/> 窗口函数案例">Hive(十三)<br> 窗口函数案例<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c42b60d6ef7b089" async="async"></script></div></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/icon.jpg" alt="Laiyy"><p class="site-author-name" itemprop="name">Laiyy</p><p class="site-description motion-element" itemprop="description">简介</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">88</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">19</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">35</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/laiyy0728" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:laiyy0728@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://www.jianshu.com/u/8fa6bf5f8bd9" target="_blank" title="简  书"><i class="fa fa-fw fa-book"></i> 简 书</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#窗口函数"><span class="nav-number">1.</span> <span class="nav-text">窗口函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#需求"><span class="nav-number">1.1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建表"><span class="nav-number">1.2.</span> <span class="nav-text">创建表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-1"><span class="nav-number">1.3.</span> <span class="nav-text">需求 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-2"><span class="nav-number">1.4.</span> <span class="nav-text">需求 2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-3"><span class="nav-number">1.5.</span> <span class="nav-text">需求 3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-4"><span class="nav-number">1.6.</span> <span class="nav-text">需求 4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-5"><span class="nav-number">1.7.</span> <span class="nav-text">需求 5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-6"><span class="nav-number">1.8.</span> <span class="nav-text">需求 6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求-7"><span class="nav-number">1.9.</span> <span class="nav-text">需求 7</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Rank-函数"><span class="nav-number">2.</span> <span class="nav-text">Rank 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#同时测试三种-rank-方式"><span class="nav-number">2.1.</span> <span class="nav-text">同时测试三种 rank 方式</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">UV:<span id="busuanzi_value_site_uv"></span></span></div> <span class="post-meta-divider">|</span><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_pv">PV:<span id="busuanzi_value_site_pv"></span></span></div><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">laiyy</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">网站总字数&#58;</span> <span title="网站总字数">151.9k 字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script></body></html><script type="text/javascript" src="/js/src/clipboard.min.js"></script><script type="text/javascript" src="/js/src/clipboard-use.js"></script>