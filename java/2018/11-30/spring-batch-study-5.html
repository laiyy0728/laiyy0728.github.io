<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><style>.pace .pace-progress{background:#1e92fb;height:3px}.pace .pace-progress-inner{box-shadow:0 0 10px #1e92fb,0 0 5px #1e92fb}.pace .pace-activity{border-top-color:#1e92fb;border-left-color:#1e92fb}</style><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><link rel="manifest" href="/images/manifest.json"><meta name="keywords" content="SpringBatch,"><link rel="alternate" href="/atom.xml" title="Laiyy 的个人小站" type="application/atom+xml"><meta name="description" content="ItemReaderItemReader 可以理解为：在批处理中，需要处理的数据。这些数据通常是在 文本文件， xml 文件， 数据库 中存储。在进行批处理的时候，需要从文件中获取数据。可以说，ItemReader 是整个批处理的入口。"><meta name="keywords" content="SpringBatch"><meta property="og:type" content="article"><meta property="og:title" content="Spring Batch 学习（5） &lt;br &#x2F;&gt; ItemReader"><meta property="og:url" content="https://www.laiyy.top/java/2018/11-30/spring-batch-study-5.html"><meta property="og:site_name" content="Laiyy 的个人小站"><meta property="og:description" content="ItemReaderItemReader 可以理解为：在批处理中，需要处理的数据。这些数据通常是在 文本文件， xml 文件， 数据库 中存储。在进行批处理的时候，需要从文件中获取数据。可以说，ItemReader 是整个批处理的入口。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2018-11-30T03:42:10.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Spring Batch 学习（5） &lt;br &#x2F;&gt; ItemReader"><meta name="twitter:description" content="ItemReaderItemReader 可以理解为：在批处理中，需要处理的数据。这些数据通常是在 文本文件， xml 文件， 数据库 中存储。在进行批处理的时候，需要从文件中获取数据。可以说，ItemReader 是整个批处理的入口。"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.laiyy.top/java/2018/11-30/spring-batch-study-5.html"><title>Spring Batch 学习（5）<br> ItemReader | Laiyy 的个人小站</title><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/laiyy0728" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Laiyy 的个人小站</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-关于我"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于我</a></li><li class="menu-item menu-item-标签"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-分类"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-归档"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://www.laiyy.top/java/2018/11-30/spring-batch-study-5.html"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Laiyy"><meta itemprop="description" content=""><meta itemprop="image" content="/images/icon.jpg"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Laiyy 的个人小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Spring Batch 学习（5）<br> ItemReader</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-30T11:42:10+08:00">2018-11-30</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1.8k 字</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">8 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="ItemReader"><a href="#ItemReader" class="headerlink" title="ItemReader"></a>ItemReader</h1><p><code>ItemReader</code> 可以理解为：在批处理中，需要处理的数据。这些数据通常是在 <em>文本文件</em>， <em>xml 文件</em>， <em>数据库</em> 中存储。在进行批处理的时候，需要从文件中获取数据。可以说，ItemReader 是整个批处理的入口。</p><a id="more"></a><p>几个常用的 ItemReader</p><blockquote><ul><li>ListItemReader：从集合中获取数据</li><li>FlatFileItemReader：从文本文件中获取数据</li><li>MultiResourceItemReader：从多个文件中获取数据</li><li>StaxEventItemReader：从 xml 文件中获取数据</li><li>AbstractPagingItemReader：从数据库中获取数据：<blockquote><ul><li>JdbcPagingItemReader：使用基础的 jdbc 获取数据</li><li>HibernatePagingItemReader：使用 Hibernate 获取数据</li><li>JpaPagingItemReader：使用 JPA 获取数据</li></ul></blockquote></li></ul></blockquote><hr><h1 id="ListItemReader"><a href="#ListItemReader" class="headerlink" title="ListItemReader"></a>ListItemReader</h1><p><code>ListItemReader</code>：声明一个集合作为数据的输入，通常用于数据量较小，内存可以处理的批处理操作；数据量过大的话，放入 ListItemReader 中可能造成内存溢出。</p><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ItemReader&lt;String&gt; <span class="title">itemReader</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ListItemReader&lt;&gt;(Arrays.asList(<span class="string">"Java"</span>, <span class="string">"Python"</span>, <span class="string">"Swift"</span>, <span class="string">"MyBatis"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="FlatFileItemReader"><a href="#FlatFileItemReader" class="headerlink" title="FlatFileItemReader"></a>FlatFileItemReader</h1><p><code>FlatFileItemReader</code>：从文本文件中获取数据，这个文本文件可以是 txt、csv 等纯文本文件。<br><code>DelimitedLineTokenizer</code>：配置数据解析方式。默认以英文逗号为数据分隔符。</p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>文本数据(任意增加，但需要保持格式)：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">27,2018-01-28 11:09:26,测试数据1,4500000001,1,1,1,laiyy,1,45000000010215405181645637</span><br><span class="line">28,2018-01-27 01:48:45,测试数据2,4500000001,1,2,1,laiyy,1,45000000010215405181645744</span><br><span class="line">29,2018-01-27 01:48:51,测试数据3,4500000001,1,3,1,laiyy,1,45000000010215405181645843</span><br></pre></td></tr></table></figure><p></p><p>声明一个实体作为每一行文本数据的映射关系：<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Template</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String siteId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> status;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> share;</span><br><span class="line">    <span class="keyword">private</span> String markId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略 get、set</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>使用 <code>FlatFileItemReader</code> 读取数据<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@StepScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FlatFileItemReader&lt;Template&gt; <span class="title">flatFileReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FlatFileItemReader&lt;Template&gt; reader = <span class="keyword">new</span> FlatFileItemReader&lt;&gt;();</span><br><span class="line">    reader.setResource(<span class="keyword">new</span> ClassPathResource(<span class="string">"data.txt"</span>));</span><br><span class="line">    <span class="comment">// 跳过第几行</span></span><br><span class="line">    reader.setLinesToSkip(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 声明数据解析</span></span><br><span class="line">    DelimitedLineTokenizer tokenizer = <span class="keyword">new</span> DelimitedLineTokenizer();</span><br><span class="line">    <span class="comment">// 声明数据分隔符，默认为英文逗号，如果使用其他分隔符需要重新设置</span></span><br><span class="line">    <span class="comment">// tokenizer.setDelimiter(",");</span></span><br><span class="line">    <span class="comment">// 声明每一行分隔符分隔的每个数据代表实体的哪个字段--需要与实体字段名一致</span></span><br><span class="line">    tokenizer.setNames(<span class="string">"id"</span>, <span class="string">"date"</span>, <span class="string">"name"</span>, <span class="string">"siteId"</span>, <span class="string">"status"</span>, <span class="string">"type"</span>, <span class="string">"userId"</span>, <span class="string">"username"</span>, <span class="string">"share"</span>, <span class="string">"markId"</span>);</span><br><span class="line">    <span class="comment">// 解析后的数据映射为对象</span></span><br><span class="line">    DefaultLineMapper&lt;Template&gt; mapper = <span class="keyword">new</span> DefaultLineMapper&lt;&gt;();</span><br><span class="line">    mapper.setLineTokenizer(tokenizer);</span><br><span class="line"></span><br><span class="line">    mapper.setFieldSetMapper(<span class="keyword">new</span> FieldSetMapper&lt;Template&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Template <span class="title">mapFieldSet</span><span class="params">(FieldSet fieldSet)</span> <span class="keyword">throws</span> BindException </span>&#123;</span><br><span class="line">            Template template = <span class="keyword">new</span> Template();</span><br><span class="line">            <span class="comment">// 数据映射</span></span><br><span class="line">            template.setId(fieldSet.readInt(<span class="string">"id"</span>));</span><br><span class="line">            template.setDate(fieldSet.readString(<span class="string">"date"</span>));</span><br><span class="line">            template.setName(fieldSet.readString(<span class="string">"name"</span>));</span><br><span class="line">            template.setSiteId(fieldSet.readString(<span class="string">"siteId"</span>));</span><br><span class="line">            template.setStatus(fieldSet.readInt(<span class="string">"status"</span>));</span><br><span class="line">            template.setType(fieldSet.readInt(<span class="string">"type"</span>));</span><br><span class="line">            template.setUserId(fieldSet.readInt(<span class="string">"userId"</span>));</span><br><span class="line">            template.setUsername(fieldSet.readString(<span class="string">"username"</span>));</span><br><span class="line">            template.setShare(fieldSet.readInt(<span class="string">"share"</span>));</span><br><span class="line">            template.setMarkId(fieldSet.readString(<span class="string">"markId"</span>));</span><br><span class="line">            <span class="keyword">return</span> template;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 数据校验</span></span><br><span class="line">    mapper.afterPropertiesSet();</span><br><span class="line">    <span class="comment">// 绑定映射</span></span><br><span class="line">    reader.setLineMapper(mapper);</span><br><span class="line">    <span class="keyword">return</span> reader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><hr><h1 id="StaxEventItemReader"><a href="#StaxEventItemReader" class="headerlink" title="StaxEventItemReader"></a>StaxEventItemReader</h1><p><code>StaxEventItemReader</code>：用于从 xml 文件中读取数据，常常和 spring-oxm 结合使用，极大提高效率</p><h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p>需要读取的 xml 数据</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" standalone="yes"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RECORDS</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RECORD</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>20<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">createDate</span>&gt;</span>2018/5/10 16:23:09<span class="tag">&lt;/<span class="name">createDate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">createUserId</span>&gt;</span>34<span class="tag">&lt;/<span class="name">createUserId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>标签1<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">siteId</span>&gt;</span>4500000001<span class="tag">&lt;/<span class="name">siteId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">status</span>&gt;</span>0<span class="tag">&lt;/<span class="name">status</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>8<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">seq</span>&gt;</span>20<span class="tag">&lt;/<span class="name">seq</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">userId</span>&gt;</span>0<span class="tag">&lt;/<span class="name">userId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RECORD</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RECORD</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>21<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">createDate</span>&gt;</span>2018/5/10 16:24:02<span class="tag">&lt;/<span class="name">createDate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">createUserId</span>&gt;</span>34<span class="tag">&lt;/<span class="name">createUserId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>标签2<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">siteId</span>&gt;</span>4500000001<span class="tag">&lt;/<span class="name">siteId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">status</span>&gt;</span>1<span class="tag">&lt;/<span class="name">status</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>8<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">seq</span>&gt;</span>22<span class="tag">&lt;/<span class="name">seq</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">userId</span>&gt;</span>0<span class="tag">&lt;/<span class="name">userId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RECORD</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RECORDS</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据实体</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Label</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String label = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">private</span> String labelType = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> createUserId;</span><br><span class="line">    <span class="keyword">private</span> String createDate;</span><br><span class="line">    <span class="keyword">private</span> String username = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> status = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> String siteId = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> seq;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略 get、set</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据读取</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@StepScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> StaxEventItemReader&lt;Label&gt; <span class="title">xmlFileReader</span><span class="params">()</span></span>&#123;</span><br><span class="line">    StaxEventItemReader&lt;Label&gt; reader = <span class="keyword">new</span> StaxEventItemReader&lt;&gt;();</span><br><span class="line">    <span class="comment">// 要读取的文件</span></span><br><span class="line">    reader.setResource(<span class="keyword">new</span> ClassPathResource(<span class="string">"label.xml"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定需要处理的根标签</span></span><br><span class="line">    reader.setFragmentRootElementName(<span class="string">"RECORD"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把读取到的 xml 格式转为 Label</span></span><br><span class="line">    XStreamMarshaller unmarshaller = <span class="keyword">new</span> XStreamMarshaller();</span><br><span class="line">    <span class="comment">// 设置要读取的 xml 根节点 --- </span></span><br><span class="line">    Map&lt;String, Class&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    map.put(<span class="string">"RECORD"</span>, Label.class);</span><br><span class="line">    unmarshaller.setAliases(map);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// marshaller ：写 xml</span></span><br><span class="line">    <span class="comment">// unmarshaller： 读 xml</span></span><br><span class="line">    reader.setUnmarshaller(unmarshaller);</span><br><span class="line">    <span class="keyword">return</span> reader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="MultiResourceItemReader"><a href="#MultiResourceItemReader" class="headerlink" title="MultiResourceItemReader"></a>MultiResourceItemReader</h1><p><code>MultiResourceItemReader</code>：可以包含多个 ResourceAwareItemReaderItemStream 的子类、实现类 所构建的文件读取 ItemReader，由此可以一次性读取多个文件。</p><p>ResourceAwareItemReaderItemStream 的几个常用实现类：</p><blockquote><ul><li>FlatFileItemReader：上一例中的文本文件读取</li><li>JsonItemReader：从 json 文件中获取数据</li><li>StaxEventItemReader：从 xml 文件中获取数据</li></ul></blockquote><h2 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h2><p><code>FlatFileItemWriter</code> 数据来源：<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;1&quot;,&quot;Kabul&quot;,&quot;AFG&quot;,&quot;Kabol&quot;,&quot;1780000&quot;</span><br><span class="line">&quot;2&quot;,&quot;Qandahar&quot;,&quot;AFG&quot;,&quot;Qandahar&quot;,&quot;237500&quot;</span><br><span class="line">&quot;3&quot;,&quot;Herat&quot;,&quot;AFG&quot;,&quot;Herat&quot;,&quot;186800&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 声明一个 txt 文件读取</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@StepScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FlatFileItemReader&lt;City&gt; <span class="title">flatFileReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FlatFileItemReader&lt;City&gt; reader = <span class="keyword">new</span> FlatFileItemReader&lt;&gt;();</span><br><span class="line">    <span class="comment">// 解析数据</span></span><br><span class="line">    DelimitedLineTokenizer tokenizer = <span class="keyword">new</span> DelimitedLineTokenizer();</span><br><span class="line">    tokenizer.setNames(<span class="string">"id"</span>, <span class="string">"name"</span>, <span class="string">"countryCode"</span>, <span class="string">"district"</span>, <span class="string">"population"</span>);</span><br><span class="line">    <span class="comment">// 解析后的数据映射为对象</span></span><br><span class="line">    DefaultLineMapper&lt;City&gt; mapper = <span class="keyword">new</span> DefaultLineMapper&lt;&gt;();</span><br><span class="line">    mapper.setLineTokenizer(tokenizer);</span><br><span class="line"></span><br><span class="line">    mapper.setFieldSetMapper(<span class="keyword">new</span> FieldSetMapper&lt;City&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> City <span class="title">mapFieldSet</span><span class="params">(FieldSet fieldSet)</span> <span class="keyword">throws</span> BindException </span>&#123;</span><br><span class="line">            City city = <span class="keyword">new</span> City();</span><br><span class="line">            city.setCountryCode(fieldSet.readString(<span class="string">"countryCode"</span>));</span><br><span class="line">            city.setDistrict(fieldSet.readString(<span class="string">"district"</span>));</span><br><span class="line">            city.setId(fieldSet.readInt(<span class="string">"id"</span>));</span><br><span class="line">            city.setName(fieldSet.readString(<span class="string">"name"</span>));</span><br><span class="line">            city.setPopulation(fieldSet.readLong(<span class="string">"population"</span>));</span><br><span class="line">            <span class="keyword">return</span> city;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 数据校验</span></span><br><span class="line">    mapper.afterPropertiesSet();</span><br><span class="line">    <span class="comment">// 绑定映射</span></span><br><span class="line">    reader.setLineMapper(mapper);</span><br><span class="line">    <span class="keyword">return</span> reader;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入 classpath下的所有以 file 开头的 txt 文件</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"classpath:file*.txt"</span>)</span><br><span class="line"><span class="keyword">private</span> Resource[] fileResources;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@StepScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MultiResourceItemReader&lt;City&gt; <span class="title">multiFileReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MultiResourceItemReader&lt;City&gt; reader = <span class="keyword">new</span> MultiResourceItemReader&lt;&gt;();</span><br><span class="line">    <span class="comment">// 文件读取</span></span><br><span class="line">    reader.setDelegate(flatFileReader());</span><br><span class="line">    <span class="comment">// 将所有文件放入 resources 中，即可实现多文件读取</span></span><br><span class="line">    reader.setResources(fileResources);</span><br><span class="line">    <span class="keyword">return</span> reader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="AbstractPagingItemReader"><a href="#AbstractPagingItemReader" class="headerlink" title="AbstractPagingItemReader"></a>AbstractPagingItemReader</h1><p>所有从数据库中分页读取数据的 <strong><em>主抽象类</em></strong> ，用于定义分页结构、分页参数等</p><h2 id="JdbcPagingItemReader"><a href="#JdbcPagingItemReader" class="headerlink" title="JdbcPagingItemReader"></a>JdbcPagingItemReader</h2><p>以 jdbc 方式分页读取数据（最原生，但是不能自动映射字段，需要自定义）</p><h3 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 注解 <span class="doctag">@StepScope</span> 表示，该数据只在 Step 执行</span></span><br><span class="line"><span class="comment">* JdbcPagingItemReader 从 jdbc 中，使用分页获取数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@StepScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JdbcPagingItemReader&lt;User&gt; <span class="title">userItemReader</span><span class="params">()</span></span>&#123;</span><br><span class="line">    JdbcPagingItemReader&lt;User&gt; reader = <span class="keyword">new</span> JdbcPagingItemReader&lt;&gt;();</span><br><span class="line">    reader.setDataSource(dataSource);</span><br><span class="line">    reader.setFetchSize(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 把读取到的记录转换为 User 对象</span></span><br><span class="line">    reader.setRowMapper(<span class="keyword">new</span> RowMapper&lt;User&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> User <span class="title">mapRow</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">            User user = <span class="keyword">new</span> User();</span><br><span class="line">            user.setId(resultSet.getInt(<span class="string">"id"</span>));</span><br><span class="line">            user.setUsername(resultSet.getString(<span class="string">"username"</span>));</span><br><span class="line">            user.setPassword(resultSet.getString(<span class="string">"password"</span>));</span><br><span class="line">            user.setAge(resultSet.getInt(<span class="string">"age"</span>));</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 指定 SQL 语句</span></span><br><span class="line">    MySqlPagingQueryProvider provider = <span class="keyword">new</span> MySqlPagingQueryProvider();</span><br><span class="line">    <span class="comment">// 查询哪些字段</span></span><br><span class="line">    provider.setSelectClause(<span class="string">"id, username, password, age"</span>);</span><br><span class="line">    <span class="comment">// 查询哪个表</span></span><br><span class="line">    provider.setFromClause(<span class="string">"from t_user"</span>);</span><br><span class="line">    <span class="comment">// 根据那个字段进行排序</span></span><br><span class="line">    Map&lt;String, Order&gt; sortMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">2</span>);</span><br><span class="line">    sortMap.put(<span class="string">"id"</span>, Order.ASCENDING);</span><br><span class="line">    sortMap.put(<span class="string">"username"</span>, Order.DESCENDING);</span><br><span class="line">    provider.setSortKeys(sortMap);</span><br><span class="line"></span><br><span class="line">    reader.setQueryProvider(provider);</span><br><span class="line">    <span class="keyword">return</span> reader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HibernatePagingItemReader"><a href="#HibernatePagingItemReader" class="headerlink" title="HibernatePagingItemReader"></a>HibernatePagingItemReader</h2><p>以 Hibernate 方式分页读取数据（可根据 Hibernate 注解自动映射字段）</p><h3 id="代码示例-3"><a href="#代码示例-3" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* HibernatePagingItemReader 实现</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@StepScope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ItemReader&lt;News&gt; <span class="title">hibernatePagingItemReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">HibernatePagingItemReader&lt;News&gt; reader = <span class="keyword">new</span> HibernatePagingItemReader&lt;&gt;();</span><br><span class="line">    <span class="comment">// 每页查询多少条</span></span><br><span class="line">    reader.setPageSize(<span class="number">500</span>);</span><br><span class="line">    reader.setSessionFactory(sessionFactory);</span><br><span class="line">    HibernateNativeQueryProvider&lt;News&gt; provider = <span class="keyword">new</span> HibernateNativeQueryProvider&lt;&gt;();</span><br><span class="line">    <span class="comment">// 自动映射解析到哪个实体（该实体需要 @Entity 注解）</span></span><br><span class="line">    provider.setEntityClass(News.class);</span><br><span class="line">    String siteId = parameterMap.get(<span class="string">"4500000001"</span>).toString();</span><br><span class="line">    <span class="keyword">int</span> channelId = Integer.valueOf(parameterMap.get(<span class="string">"2016"</span>).toString());</span><br><span class="line">    StringBuilder sql = <span class="keyword">new</span> StringBuilder(<span class="string">"SELECT * FROM zw_news where site_id ="</span>);</span><br><span class="line">    sql.append(siteId);</span><br><span class="line">    <span class="keyword">if</span> (channelId != <span class="number">0</span>) &#123;</span><br><span class="line">        sql.append(<span class="string">" and channel_id = "</span>).append(channelId);</span><br><span class="line">    &#125;</span><br><span class="line">    sql.append(<span class="string">" and status = 150 and del_status != 500"</span>);</span><br><span class="line">    sql.append(<span class="string">" order by news_weight desc, seq desc, pub_date desc, id desc "</span>);</span><br><span class="line">    provider.setSqlQuery(sql.toString());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 参数校验</span></span><br><span class="line">        provider.afterPropertiesSet();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"获取 Hibernate 数据失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    reader.setQueryProvider(provider);</span><br><span class="line">    <span class="comment">// 可有可无</span></span><br><span class="line">    reader.setQueryName(<span class="string">" News"</span>);</span><br><span class="line">    reader.setUseStatelessSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> reader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#bbb;font-size:15px"><br>-------------本文结束<i class="fa fa-paw"></i> 感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Laiyy</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.laiyy.top/java/2018/11-30/spring-batch-study-5.html" title="Spring Batch 学习（5） <br /> ItemReader">https://www.laiyy.top/java/2018/11-30/spring-batch-study-5.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/SpringBatch/" rel="tag"><i class="fa fa-tag"></i> SpringBatch</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/java/2018/11-29/spring-batch-study-4.html" rel="next" title="Spring Batch 学习（4） <br /> Step 的另一种方式、Listener"><i class="fa fa-chevron-left"></i> Spring Batch 学习（4）<br> Step 的另一种方式、Listener</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/java/2018/12-03/spring-batch-study-6.html" rel="prev" title="Spring Batch 学习（6） <br /> ItemWriter">Spring Batch 学习（6）<br> ItemWriter<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c42b60d6ef7b089" async="async"></script></div></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/icon.jpg" alt="Laiyy"><p class="site-author-name" itemprop="name">Laiyy</p><p class="site-description motion-element" itemprop="description">简介</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">30</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">9</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/laiyy0728" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:396043429@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ItemReader"><span class="nav-number">1.</span> <span class="nav-text">ItemReader</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ListItemReader"><span class="nav-number">2.</span> <span class="nav-text">ListItemReader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#示例："><span class="nav-number">2.1.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#FlatFileItemReader"><span class="nav-number">3.</span> <span class="nav-text">FlatFileItemReader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#示例"><span class="nav-number">3.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#StaxEventItemReader"><span class="nav-number">4.</span> <span class="nav-text">StaxEventItemReader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#代码示例"><span class="nav-number">4.1.</span> <span class="nav-text">代码示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MultiResourceItemReader"><span class="nav-number">5.</span> <span class="nav-text">MultiResourceItemReader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#代码示例-1"><span class="nav-number">5.1.</span> <span class="nav-text">代码示例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AbstractPagingItemReader"><span class="nav-number">6.</span> <span class="nav-text">AbstractPagingItemReader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JdbcPagingItemReader"><span class="nav-number">6.1.</span> <span class="nav-text">JdbcPagingItemReader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码示例-2"><span class="nav-number">6.1.1.</span> <span class="nav-text">代码示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HibernatePagingItemReader"><span class="nav-number">6.2.</span> <span class="nav-text">HibernatePagingItemReader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#代码示例-3"><span class="nav-number">6.2.1.</span> <span class="nav-text">代码示例</span></a></li></ol></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">UV:<span id="busuanzi_value_site_uv"></span></span></div> <span class="post-meta-divider">|</span><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_pv">PV:<span id="busuanzi_value_site_pv"></span></span></div><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">laiyy</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">网站总字数&#58;</span> <span title="网站总字数">42.2k 字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/three/three.min.js"></script><script type="text/javascript" src="/lib/three/three-waves.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script></body></html>